# ===================================================================
# 安全配置
# ===================================================================

# 安全配置
security:
  # JWT配置
  jwt:
    secret-key: ${JWT_SECRET_KEY:workflow-platform-jwt-secret-key-change-in-production}
    expiration: ${JWT_EXPIRATION:86400000}  # 24小时
    refresh-expiration: ${JWT_REFRESH_EXPIRATION:604800000}  # 7天
    issuer: workflow-platform
    audience: workflow-client

  # 密码加密
  password:
    encoder:
      strength: 10
      algorithm: bcrypt

  # CORS配置
  cors:
    allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:8080}
    allowed-methods: GET,POST,PUT,DELETE,PATCH,OPTIONS
    allowed-headers: Authorization,Content-Type,X-Requested-With,Accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers
    exposed-headers: Authorization,Content-Disposition
    allow-credentials: true
    max-age: 3600

  # CSRF配置
  csrf:
    enabled: false  # REST API通常禁用CSRF

  # 会话管理
  session:
    creation-policy: stateless
    timeout: 1800  # 30分钟

  # 记住我
  remember-me:
    enabled: false

  # 防火墙
  firewall:
    enabled: true
    allow-url-encoded-slash: true
    allow-url-encoded-percent: true

  # 请求限制
  request:
    limit:
      enabled: true
      max-requests-per-second: 50
      burst-capacity: 100

  # 内容安全策略
  content-security-policy:
    enabled: true
    policy: "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:;"

  # 安全头
  headers:
    enabled: true
    hsts:
      enabled: true
      max-age: 31536000
      include-subdomains: true
    content-type-options: true
    frame-options: DENY
    xss-protection:
      enabled: true
      mode: block

# OAuth2配置（如果使用）
oauth2:
  client:
    registration:
      github:
        client-id: ${GITHUB_CLIENT_ID:}
        client-secret: ${GITHUB_CLIENT_SECRET:}
        scope: user:email,read:user
      google:
        client-id: ${GOOGLE_CLIENT_ID:}
        client-secret: ${GOOGLE_CLIENT_SECRET:}
        scope: email,profile
  resource-server:
    jwt:
      jwk-set-uri: ${JWK_SET_URI:}

# API密钥管理
api-keys:
  enabled: true
  keys:
    - name: web-client
      key: ${WEB_CLIENT_API_KEY:web-client-key}
      roles: ROLE_USER
    - name: mobile-client
      key: ${MOBILE_CLIENT_API_KEY:mobile-client-key}
      roles: ROLE_USER
    - name: admin-client
      key: ${ADMIN_CLIENT_API_KEY:admin-client-key}
      roles: ROLE_ADMIN

# 角色权限配置
roles:
  admin:
    permissions:
      - workflow:create
      - workflow:read
      - workflow:update
      - workflow:delete
      - workflow:execute
      - user:manage
      - system:configure
  user:
    permissions:
      - workflow:create
      - workflow:read
      - workflow:update
      - workflow:execute
  viewer:
    permissions:
      - workflow:read

# 端点安全
endpoints:
  public:
    - /api/auth/login
    - /api/auth/register
    - /api/public/**
    - /swagger-ui/**
    - /api-docs/**
    - /h2-console/**
  authenticated:
    - /api/**
  admin-only:
    - /api/admin/**
    - /api/system/**
    - /api/backup/**